<template>
    <div style="position:relative">
        <template if:true={isLoading}>
            <lightning-spinner alternative-text="Loading" variant="brand" size="large">
            </lightning-spinner>
        </template>
        <lightning-card icon-name="standard:custom_notification">
            <h1 slot="title">
                <p style="display:inline-block">{title}</p>
                <template if:false={success}>
                    <lightning-helptext style="padding: 3px;vertical-align: text-top;" content="Before we continue to a new quote, we need to review and confirm the previous contract of the account you are working on.
                    Once you will confirm it- the previous contract will be created in the system and you will have the option to generate a new quote in order to change this contract.
                    This action is being taken as part of our companyâ€™s effort to fix our existing clientâ€™s contracts data and create a reliable contracts repository.
                    Thanks for your cooperation! <3"></lightning-helptext>
                </template>
            </h1>
            <template if:false={success}>
                <lightning-layout multiple-rows>
                <lightning-record-edit-form object-api-name="Contract">
                    <div class="slds-grid slds-wrap">
                        <div class="slds-col slds-p-horizontal_medium">
                            <lightning-messages></lightning-messages>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="seatsId" class="slds-form-element__label slds-no-flex">Current Plan Seats</label>
                                    <lightning-input-field id="seatsId" field-name="Seats__c" variant="label-hidden" value={seats} onchange={handleSeats}></lightning-input-field>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="tierId" class="slds-form-element__label slds-no-flex">Current Plan Tier</label>
                                    <lightning-input-field id="tierId" field-name="Tier__c" variant="label-hidden" value={tier} disabled></lightning-input-field>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="startid" class="slds-form-element__label slds-no-flex">Current Start Date</label>
                                    <lightning-input-field id="startid" field-name="StartDate" variant="label-hidden" value={startDate} onchange={handleStart}></lightning-input-field>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="endid" class="slds-form-element__label slds-no-flex">Current End Date</label>
                                    <lightning-input-field id="endid" field-name="EndDate" variant="label-hidden" value={endDate} onchange={handleEnd}></lightning-input-field>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="lpId" class="slds-form-element__label slds-no-flex">Current List Price ({currency})</label>
                                    <lightning-helptext content="Price Per Seat"></lightning-helptext>
                                    <!--<lightning-input-field id="lpId" field-name="List_Price__c" variant="label-hidden" value={listPrice} disabled></lightning-input-field>-->
                                    <lightning-input id="lpId" type="number" name="list price" disabled={isListPriceDisabled} value={listPrice} variant="label-hidden" onchange={handleListPrice}></lightning-input>
                                </div>
                            </lightning-layout-item>
                        </div>
                        <div class="slds-col slds-p-horizontal_medium">
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="upId" class="slds-form-element__label slds-no-flex">Current Unit Price ({currency})</label>
                                    <lightning-helptext content="Price Per Seat"></lightning-helptext>
                                    <!--<lightning-input-field id="upId" field-name="Unit_Price__c" variant="label-hidden" value={unitPrice} onchange={handleUnitPrice}></lightning-input-field>-->
                                    <lightning-input id="upId" type="number" name="unit price" variant="label-hidden" value={unitPrice} step="0.01" onchange={handleUnitPrice}></lightning-input>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="disid" class="slds-form-element__label slds-no-flex">Current Discount %</label>
                                    <lightning-input id="disid" type="number" name="Discount %" variant="label-hidden" label="Discount %" value={discount} step="0.01" onchange={handleDiscount}></lightning-input>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="termid" class="slds-form-element__label slds-no-flex">Current Contract Term (Months)</label>
                                    <lightning-input id="termid" type="number" name="Contract Term" variant="label-hidden" label="Contract Term" value={termMonths} disabled></lightning-input>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="paidid" class="slds-form-element__label slds-no-flex">Current Paid Months</label>
                                    <lightning-input-field id="paidid" field-name="Paid_Months__c" variant="label-hidden" value={paid} onchange={handlePaid}></lightning-input-field>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <div class="custom-box">
                                    <label for="freeid" class="slds-form-element__label slds-no-flex">Current Free Months</label>
                                    <lightning-input-field id="freeid" field-name="Free_Months__c" variant="label-hidden" value={free} onchange={handleFree}></lightning-input-field>
                                </div>
                            </lightning-layout-item>
                            <lightning-layout-item size="12" padding="around-small">
                                <lightning-input-field field-name="AccountId" value={accountId} class="slds-hide"></lightning-input-field>
                            </lightning-layout-item>
                        </div>
                    </div>
                </lightning-record-edit-form>
                <div class="slds-grid slds-gutters">
                    <div class="slds-col slds-size_9-of-12">
                        <lightning-layout-item size="12" padding="around-small">
                            <lightning-formatted-url value={linkToBB} label="Not sure about the previous contract details? go see in BigBrain" tooltip="Link to BigBrain" target="_blank" style="font-size: smaller;
                            text-decoration: underline;"></lightning-formatted-url>
                        </lightning-layout-item>
                    </div>
                    <div class="slds-col slds-size_3-of-12">
                        <lightning-layout-item size="12" padding="around-medium" >
                            <!--<lightning-button class="slds-m-top_small" type="submit" label="Save" onclick={handleSuccess}></lightning-button>-->
                            <lightning-button class="slds-m-top_large" variant="brand" label="Save" onclick={handleSave}></lightning-button>
                        </lightning-layout-item>
                    </div>
                  </div>
                </lightning-layout>
            </template>
            <template if:true={success}>
                <template if:true={redirectToDH}>
                    <lightning-layout-item padding="around-medium">
                        <div class="slds-p-around_medium lgc-bg">
                            <lightning-tile type="media">
                                <lightning-icon slot="media" icon-name="action:check" size="x-small"></lightning-icon>
                                <lightning-button class="slds-p-top_x-large" label="Continue to DealHub" onclick={goToDealHub}></lightning-button>
                            </lightning-tile>
                        </div>
                    </lightning-layout-item>
                </template>
                <template if:false={redirectToDH}>
                    <lightning-layout-item padding="around-medium">
                        <p>{message}</p>
                    </lightning-layout-item>
                </template>
            </template>
        </lightning-card>
    </div>
</template>