<aura:component controller="Ctrl_BillingEntityRelate" implements="force:lightningQuickActionWithoutHeader,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,force:appHostable" access="global">
	<ltng:require styles="{! $Resource.ModalWidthCSS }" />
	<lightning:notificationsLibrary aura:id="notifLib"/>
	
	<aura:attribute name="list_best_match" type="List" description="List best match (single match)" />
	<aura:attribute name="list_more_options" type="List" description="List more options (single match)" />
	<aura:attribute name="selected_be" type="object" description="Selected Billing Entity by lookup" />
	<aura:attribute name="currently_selected" type="string" description="Final selected Billing Entity" />
	
	
	<aura:attribute name="selected_best_match" type="string" description="Selected best match (single match)" />
	
	<aura:attribute name="selected_more_option" type="string" description="Selected more option (single match)" />
	
	
	<aura:attribute name="form_new" type="boolean" description="Show create new Billing Entity form" default="false" />
	<aura:attribute name="enable_form_new" type="boolean" description="Enable create new Billing Entity form" default="false" />
	<aura:attribute name="form_new_fields" type="List" description="New Billing Entity field set" />
	<aura:attribute name="selection_mode" type="string" description="Choose existing or Search selection mode" default="choose existing" />
	
    <aura:attribute name="message" description="Message" type="string" />
	
	<aura:handler name="init" value="{! this }" action="{! c.doInit }" />
	<aura:handler name="change" value="{! v.selected_be }" action="{! c.beChanged }" />
    
    <header class="slds-modal__header">
        <h2 id="modal-heading-01" class="slds-text-heading_medium slds-hyphenate">Billing Entity</h2>
    </header>
    <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1" style="min-height: 420px;">
        <ui:outputText value="{! v.message }" class="message" />
		
		<section class="page-part select">
			<div class="part-header">
				<div class="header-left">
					<ui:inputRadio aura:id="m1" name="mode" value="{! v.selection_mode == 'choose existing' }" label="Choose Existing" change="{! c.modeChanged }"/>
				</div>
				<div class="header-center">
					
				</div>
			</div>
			<div class="part-body">
				<table class="matches">
					<thead>
						<tr><th>Customer Name</th><th>Connected to</th><th style="width: 182px">Billing Currency</th><th>Billing Address</th><th>Shipping Address</th></tr>
					</thead>
					<tbody>
						<aura:iteration items="{! v.list_best_match }" var="match" indexVar="i">
							<tr class="selected">
								<td><ui:inputCheckbox aura:id="cb" name="{! match.bEId }" value="{! v.currently_selected == match.bEId }" label="{! match.customerName }" change="{! c.cbChanged }" /></td>
								<td>{! match.connectedTo } &nbsp;</td>
								<td>{! match.bECurrency } &nbsp;</td>
								<td>{! match.billingAddress } &nbsp;</td>
                                <td>{! match.shippingAddress } &nbsp;</td>
							</tr>
						</aura:iteration>
						<aura:iteration items="{! v.list_more_options }" var="match" indexVar="i">
							<tr>
								<td><ui:inputCheckbox aura:id="cb" name="{! match.bEId }" value="{! v.currently_selected == match.bEId }" label="{! match.customerName }" change="{! c.cbChanged }" /></td>
								<td>{! match.connectedTo } &nbsp;</td>
								<td>{! match.bECurrency } &nbsp;</td>
								<td>{! match.billingAddress } &nbsp;</td>
                                <td>{! match.shippingAddress } &nbsp;</td>
							</tr>
						</aura:iteration>
					</tbody>
				</table>
				<div class="btn-wrap">
					<lightning:button variant="brand" label="Confirm" value="{! v.currently_selected }" onclick="{! c.relate }" disabled="{! or(v.currently_selected == null, v.currently_selected == '') }" />
				</div>
			</div>
		</section>
		
		<section class="page-part lookup">
			<div class="part-header">
				<div class="header-left">
					<ui:inputRadio aura:id="m2" name="mode" value="{! v.selection_mode == 'search' }" label="Search" change="{! c.modeChanged }"/>
				</div>
				<div class="header-center">
					
				</div>
			</div>
			<div class="part-body">
				<div class="lookup-container">
					<c:Lookup objectName="Billing_Entity__c" singleChoose="false" field_API_text="Name" field_API_val="Id" limit="50" field_API_search="Name" lookupIcon="custom:custom16" 
								  selItem="{! v.selected_be }" />
				</div>
				<div class="lookup-relate-btn-container">
					<lightning:button variant="brand" label="Confirm" value="{! v.currently_selected }" onclick="{! c.relate }" disabled="{! or(v.selected_be == null, v.selected_be == '') }" />
				</div>
			</div>
		</section>
		
		<section class="page-part add-new">
			<div class="part-header">
				<div class="header-left">
					
				</div>
				<div class="header-center">
					
				</div>
			</div>
			<div class="part-body">
				<span class="plain-label">Couldn't find it?</span> <lightning:button variant="base" label="Create New" class="link-btn" onclick="{! c.openNew }" disabled="{! not(v.enable_form_new) }" />
			</div>
		</section>
		
		
		<!--
		
		<div class="slds-gutters cmp-row">
			<div class="slds-col slds-size_1-of-1">
				<label for="best-match" class="common__label">Best Match:</label>
			</div>
			<div class="slds-col slds-size_1-of-1 pill-cb-group">
				<div class="cb-wrap">
					<lightning:radioGroup aura:id="best-match" id="best-match" name="best-match" variant="label-hidden" options="{! v.list_best_match }" value="{! v.selected_best_match }" onchange="{! c.bmChanged }" />
				</div>
				<div class="btn-wrap">
					<lightning:button variant="base" label="Relate" value="{! v.currently_selected }" onclick="{! c.relate }" disabled="{! v.selected_best_match == null }" />
				</div>
			</div>
		</div>
		
		<div class="slds-gutters cmp-row">
			<div class="slds-col slds-size_1-of-1">
				<label for="best-match" class="common__label">More Options:</label>
			</div>
			<div class="slds-col slds-size_1-of-1 pill-cb-group">
				<div class="cb-wrap">
					<lightning:radioGroup aura:id="more-options" id="more-options" name="best-match" variant="label-hidden" options="{! v.list_more_options }" value="{! v.selected_more_option }" onchange="{! c.bmChanged }" />
				</div>
				<div class="btn-wrap">
					<lightning:button variant="base" label="Relate" value="{! v.currently_selected }" onclick="{! c.relate }" disabled="{! v.selected_more_option == null }" />
				</div>
			</div>
		</div>
		
		<div class="slds-gutters cmp-row">
			<div class="slds-col slds-size_1-of-1">
				<label for="best-match" class="common__label">Lookup:</label>
			</div>
			<div class="slds-col slds-size_1-of-1 pill-cb-group">
				<div class="cb-wrap for-lookup">
					<c:Lookup objectName="Billing_Entity__c" singleChoose="false" field_API_text="Name" field_API_val="Id" limit="50" field_API_search="Name" lookupIcon="custom:custom16" 
							  selItem="{! v.selected_be }" />
				</div>
				<div class="btn-wrap">
					<lightning:button variant="base" label="Relate" value="{! v.currently_selected }" onclick="{! c.relate }" disabled="{! or(v.selected_be == null, v.selected_be == '') }" />
				</div>
			</div>
		</div>
		
		<div class="slds-gutters last">
			<div class="slds-col slds-size_1-of-1 btn-container">
				<lightning:button variant="brand" label="Create New Billing Entity" onclick="{! c.openNew }" disabled="{! not(v.enable_form_new) }" />
			</div>
		</div>
		-->


        <lightning:spinner alternativeText="Loading" size="medium" class="slds-hide" aura:id="cmspinner" />
    </div>    
	<!--
    <footer class="modalFooter">
        <lightning:button label="Close" class="slds-button slds-button_neutral" onclick="{! c.closeDialog }" />
    </footer>
	-->

	<aura:if isTrue="{! v.form_new }">
		<div class="full-mask">
			<section class="form-new-container">
				<h1>Create New Billing Entity</h1>
				<div class="error-msg">{! v.message }</div>
				<lightning:recordEditForm aura:id="mainBEForm" objectApiName="Billing_Entity__c" onsubmit="{! c.handleSubmit }" onsuccess="{! c.handleSuccess }" onerror="{! c.handleError }">
					<aura:iteration items="{! v.form_new_fields }" var="field" indexVar="i">
						<div class="slds-grid slds-gutters">
							<div class="slds-col slds-size_1-of-1">
								<lightning:inputField variant="label-stacked" required="true" fieldName="{! field }" />
							</div>
						</div>
					</aura:iteration>
					<section class="form-btn-container">
						<lightning:button label="Cancel" onclick="{! c.closeNew }" />
						<lightning:button variant="brand" type="submit" label="Submit" onclick="{! c.openNew }" disabled="{! not(v.enable_form_new) }" />
					</section>
				</lightning:recordEditForm>
				<lightning:spinner alternativeText="Loading" size="medium" class="slds-hide" aura:id="cmspinnernew" />
			</section>
		</div>
	</aura:if>
</aura:component>